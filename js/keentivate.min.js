var keentivate=function(e,t,n,r){var i=this;i.ready=!1;var s={keenClass:!1,timeframe:"previous_7_days"};if(typeof e=="undefined"){i.log("You must supply a token");return!1}if(typeof t=="undefined"){i.log("You must supply an API Key");return!1}if(typeof n=="function"){r=n;n=null}if(typeof n=="undefined"||n===null)n={};i.options=i.merge(s,n);Keen.configure(e,t);Keen.onChartsReady(function(){i.options.keenClass?i.load(i.options.keenClass,r):typeof r=="function"&&r()})};keentivate.prototype.load=function(e,t){var n=this,r=document.getElementsByClassName(e);if(!r.length){n.log("No elements match that class name");return!1}n.unload();n.elements=r;var i=0,s=function(){i++;i>=u&&typeof t=="function"&&t()};for(var o=0,u=n.elements.length;o<u;o++){var a=n.elements[o],f=a.hasAttribute("keen-type")?a.getAttribute("keen-type"):"number",l=n.renderNumber;switch(f){case"number":l=n.renderNumber;break;case"pie":l=n.renderPie;break;case"bar":l=n.renderBar;break;case"funnel":l=n.renderFunnel;break;case"line":l=n.renderLine;break;default:n.log("Invalid keen-type attribute: "+f+".  Assuming number")}l.apply(n,[a,s])}};keentivate.prototype.unload=function(){var e=this};keentivate.prototype.renderPie=function(e,t){var n=this,r=new keentivatePie(n,e,t)};keentivate.prototype.renderBar=function(e,t){var n=this,r=new keentivateBar(n,e,t)};keentivate.prototype.renderNumber=function(e,t){var n=this,r=new keentivateNumber(n,e,t)};keentivate.prototype.renderFunnel=function(e,t){var n=this,r=new keentivateFunnel(n,e,t)};keentivate.prototype.renderLine=function(e,t){var n=this,r=new keentivateLine(n,e,t)};keentivate.prototype.merge=function(e,t){var n=this,r={},i;for(i in e)r[i]=e[i];for(i in t)r[i]=t[i];return r};keentivate.prototype.log=function(){var e=this;[].unshift.apply(arguments,[Date.now()]);[].unshift.apply(arguments,["Keentivate"]);console.log.apply(console,arguments)};var Keen=Keen||{configure:function(e,t,n){this._pId=e;this._ak=t;this._op=n},addEvent:function(e,t,n,r){this._eq=this._eq||[];this._eq.push([e,t,n,r])},setGlobalProperties:function(e){this._gp=e},onChartsReady:function(e){this._ocrq=this._ocrq||[];this._ocrq.push(e)}};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"==document.location.protocol?"https://":"http://")+"dc8na2hxrj29i.cloudfront.net/code/keen-2.0.0-min.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();var keentivateChart=function(){this.init(arguments)};keentivateChart.prototype.super=function(e,t){var n=this;if(typeof e=="undefined")throw new Error("You have to pass keentivate to keentivateChart");n.k=e;if(typeof t=="undefined"){console.log(n.k);n.k.log("You have to pass an element to keentivateChart")}n.element=t;n.stop=!1;typeof n.options=="undefined"&&(n.options={});var r={metric:{analysisType:"count"},label:{}};n.options=n.k.merge(r,n.options);n.startRender()};keentivateChart.prototype.requiredAttributes={event:"eventCollection"};keentivateChart.prototype.optionalMetricAttributes={"metric-type":"analysisType",filters:"filters",timeframe:"timeframe",group:"groupBy",target:"targetProperty",timeframe:"timeframe",interval:"interval"};keentivateChart.prototype.optionalLabelAttributes={label:"label",title:"title",prefix:"prefix",suffix:"suffix",height:"height",width:"width",font:"font-family","font-color":"fontColor","border-radius":"border-radius",color:"color",colors:"colors","number-background":"number-background-color","label-background":"label-background-color",x:"xAxisLabel",y:"yAxisLabel","x-angle":"xAxisLabelAngle",background:"backgroundColor","chart-height":"chartAreaHeight","chart-width":"chartAreaWidth","chart-top":"chartAreaTop","chart-left":"chartAreaLeft","line-width":"lineWidth","show-legend":"showLegend","label-mapping":"labelMapping","minimum-slice":"minimumSlicePercentage"};keentivateChart.prototype.startRender=function(){var e=this;e.checkRequiredFields();e.getMetric();typeof e.draw=="function"&&e.draw()};keentivateChart.prototype.getMetric=function(){var e=this;if(e.stop)return!1;e.metric=new Keen.Metric(e.getField("event"),e.getMetricOptions());var t=e.getFilters();for(var n=0,r=t.length;n<r;n++){var i=t[n];e.metric.addFilter(i.property,i.operator,i.value)}};keentivateChart.prototype.getFilters=function(){var e=this,t={"=":"%DOSPLIT%eq%DOSPLIT%","!=":"%DOSPLIT%ne%DOSPLIT%","<":"%DOSPLIT%lt%DOSPLIT%","<= ":"%DOSPLIT%lte%DOSPLIT%",">":"%DOSPLIT%gt%DOSPLIT%",">=":"%DOSPLIT%gte%DOSPLIT%","\\?":"%DOSPLIT%exists%DOSPLIT%"},n=e.getField("filter");if(n){for(key in t)n=n.replace(new RegExp(key,"g"),t[key]);var r=n.split("|"),i=[];for(var s=0,o=r.length;s<o;s++){var u=r[s].replace(/^\s\s*/,"").replace(/\s\s*$/,"");while(u.indexOf("  ")>-1)u.replace("  "," ");var a=u.split("%DOSPLIT%");if(a.length==3){a[2]==="true"?a[2]=!0:a[2]==="false"&&(a[2]=!1);i.push({property:a[0],operator:a[1],value:a[2]})}}return i}return[]};keentivateChart.prototype.checkRequiredFields=function(){var e=this;if(e.stop)return!1;if(typeof e.requiredAttributes=="undefined"){e.k.log("No required attributes defined");e.stop=!0;return!1}var t=!1;for(var n in e.requiredAttributes)if(!e.element.hasAttribute("keen-"+n)&&(n!=="timeframe"||!e.element.hasAttribute("keen-start")||!e.element.hasAttribute("keen-end"))){e.k.log("Required key not set on keen element: "+n);t=!0;break}t&&(e.stop=!0);return!t};keentivateChart.prototype.getMetricOptions=function(){return this.k.merge(this.options.metric,this.getOptions(this.optionalMetricAttributes))};keentivateChart.prototype.getLabelOptions=function(){return this.getOptions(this.optionalLabelAttributes)};keentivateChart.prototype.getOptions=function(e){var t=this;if(t.stop)return!1;var n={};for(var r in e)t.element.hasAttribute("keen-"+r)?n[e[r]]=t.element.getAttribute("keen-"+r):r==="timeframe"&&t.element.hasAttribute("keen-start")&&t.element.hasAttribute("keen-end")&&(n[e[r]]={start:t.element.getAttribute("keen-start"),end:t.element.getAttribute("keen-end")});return n};keentivateChart.prototype.getField=function(e){var t=this;return t.stop?!1:t.element.hasAttribute("keen-"+e)?t.element.getAttribute("keen-"+e):!1};keentivateChart.prototype.onRender=function(){var self=this;if(self.element.hasAttribute("keen-on-render")){var func=self.element.getAttribute("keen-on-render");eval(func)}};var keentivatePie=function(){this.init(arguments)};keentivatePie.prototype=Object.create(keentivateChart.prototype);keentivatePie.prototype.requiredAttributes={event:"eventCollection",group:"groupBy"};keentivatePie.prototype.init=function(){var e=this;e.chartType="pie";e.super.apply(e,arguments[0])};keentivatePie.prototype.draw=function(){var e=this;if(e.stop)return!1;var t=new Keen.PieChart(e.metric,e.getLabelOptions());t.draw(e.element)};var keentivateBar=function(){this.init(arguments)};keentivateBar.prototype=Object.create(keentivateChart.prototype);keentivateBar.prototype.requiredAttributes={event:"eventCollection",group:"groupBy"};keentivateBar.prototype.init=function(){var e=this;e.chartType="bar";e.super.apply(e,arguments[0])};keentivateBar.prototype.draw=function(){var e=this;if(e.stop)return!1;var t=new Keen.BarChart(e.metric,e.getLabelOptions());t.draw(e.element)};var keentivateNumber=function(){this.init(arguments)};keentivateNumber.prototype=Object.create(keentivateChart.prototype);keentivateNumber.prototype.init=function(){var e=this;e.chartType="number";e.super.apply(e,arguments[0])};keentivateNumber.prototype.draw=function(){var e=this;if(e.stop)return!1;var t=new Keen.Number(e.metric,e.getLabelOptions());t.draw(e.element)};var keentivateFunnel=function(){this.init(arguments)};keentivateFunnel.prototype=Object.create(keentivateChart.prototype);keentivateFunnel.prototype.requiredAttributes={watch:"actorProperty"};keentivateFunnel.prototype.optionalMetricAttributes={watch:"actorProperty"};keentivateFunnel.prototype.init=function(){var e=this;e.chartType="pie";e.super.apply(e,arguments[0])};keentivateFunnel.prototype.draw=function(){var e=this;if(e.stop)return!1;var t=new Keen.Funnel(e.steps,e.getMetricOptions());t.draw(e.element,e.getLabelOptions())};keentivateFunnel.prototype.getSteps=function(){var e=this,t=e.element.getElementsByTagName("li");if(!t.length){e.stop=!0;e.k.log("You must provide steps for funnels");return!1}e.steps=[];for(var n=0,r=t.length;n<r;n++){var i=t[n];if(!i.hasAttribute("keen-event")){e.stop=!0;e.k.log("All steps must have an event attribute");return!1}var s=i.getAttribute("keen-event"),o=e.getStepFilters(i);console.log({filters:o});var u=new Keen.Step(s);for(var a=0,f=o.length;a<f;a++)u.addFilter(o[a].property,o[a].operator,o[a].value);e.steps.push(u)}};keentivateFunnel.prototype.getStepFilters=function(e){var t=this,n={"=":"%DOSPLIT%eq%DOSPLIT%","!=":"%DOSPLIT%ne%DOSPLIT%","<":"%DOSPLIT%lt%DOSPLIT%","<= ":"%DOSPLIT%lte%DOSPLIT%",">":"%DOSPLIT%gt%DOSPLIT%",">=":"%DOSPLIT%gte%DOSPLIT%","\\?":"%DOSPLIT%exists%DOSPLIT%"};if(!e.hasAttribute("keen-filter"))return[];var r=e.getAttribute("keen-filter");if(r){for(key in n)r=r.replace(new RegExp(key,"g"),n[key]);var i=r.split("|"),s=[];for(var o=0,u=i.length;o<u;o++){var a=i[o].replace(/^\s\s*/,"").replace(/\s\s*$/,"");while(a.indexOf("  ")>-1)a.replace("  "," ");var f=a.split("%DOSPLIT%");if(f.length==3){f[2]==="true"?f[2]=!0:f[2]==="false"&&(f[2]=!1);s.push({property:f[0],operator:f[1],value:f[2]})}}return s}return[]};keentivateFunnel.prototype.startRender=function(){var e=this;e.checkRequiredFields();e.getSteps();e.draw()};var keentivateLine=function(){this.init(arguments)};keentivateLine.prototype=Object.create(keentivateChart.prototype);keentivateLine.prototype.requiredAttributes={timeframe:"timeframe",interval:"interval",event:"eventCollection"};keentivateLine.prototype.init=function(){var e=this;e.chartType="line";e.super.apply(e,arguments[0])};keentivateLine.prototype.getMetric=function(){var e=this;if(e.stop)return!1;e.metric=new Keen.Series(e.getField("event"),e.getMetricOptions());var t=e.getFilters();for(var n=0,r=t.length;n<r;n++){var i=t[n];e.metric.addFilter(i.property,i.operator,i.value)}};keentivateLine.prototype.draw=function(){var e=this;if(e.stop)return!1;var t=new Keen.LineChart(e.metric,e.getLabelOptions());t.draw(e.element)};